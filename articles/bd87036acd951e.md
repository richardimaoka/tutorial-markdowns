---
title: "コピペで学ぶチュートリアル: DockerfileのCMDとENTRYPOINTの違い"
emoji: "🐷"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["docker"]
published: false
---

Dockerfile の CMD と ENTRYPOINT について、手を動かして動作確認できるチュートリアルもあると理解がしやすいかと思い、コピペだけで簡単に学べるチュートリアルを作成しました。

:::details それぞれの違いについては公式ドキュメントでも、数多くのブログ記事などでも解説されています。

- [Dockerfile reference](https://docs.docker.com/engine/reference/builder/#cmd)
- [Best practices for writing Dockerfiles](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#cmd)
- POCKETSTUDIO.NET (前佛 雅人さんのブログ) - [ENTRYPOINT は「必ず実行」、CMD は「（デフォルトの）引数」](https://pocketstudio.net/2020/01/31/cmd-and-entrypoint/)

:::

## 事前準備

まずは今回のチュートリアルで利用する Dockerfile が保存されている GitHub レポジトリをクローンします。

```sh
git clone git@github.com:richardimaoka/tutorial-docker-cmd-entrypoint.git
cd tutorial-docker-cmd-entrypoin
```

## CMD の動作理解

まずは CMD だけを先に理解することを目指し、いったん ENTRYPOINT のことを忘れましょう。これは両者がとても似ていて、同時に理解しようとすると混乱するからです。

```dockerfile:Dockerfile.cmd1
FROM ubuntu
CMD ["echo", "abc"]
```

上記の Dockerfile を build して run しましょう。冒頭でクローンした GitHub レポジトリに Dockerfile.cmd1 が含まれているので、以下のコマンドをターミナルで実行してください。

以下のコマンドを実行してください。

```sh
docker build -t cmd1 -f Dockerfile.cmd1 .
docker run cmd1
```

```sh:docker runの結果
abc
```

```dockerfile:Dockerfile.cmd2
FROM ubuntu
CMD ["echo", "abc", "def"]
```

以下のコマンドを実行してください。

```sh
docker build -t cmd2 -f Dockerfile.cmd2 .
docker run cmd2
```

```dockerfile:Dockerfile.cmd3
FROM ubuntu
CMD echo "abc"
```

以下のコマンドを実行してください。

```sh
docker build -t cmd3 -f Dockerfile.cmd3 .
docker run cmd3
```

```dockerfile:Dockerfile.cmd4
FROM ubuntu
CMD echo "abc" "def"
```

以下のコマンドを実行してください。

```sh
docker build -t cmd4 -f Dockerfile.cmd4 .
docker run cmd4
```

```dockerfile:Dockerfile.cmd5
FROM ubuntu
CMD echo "$HOME"
```

以下のコマンドを実行してください。

```sh
docker build -t cmd5 -f Dockerfile.cmd5 .
docker run cmd5
```

```dockerfile:Dockerfile.cmd6
FROM ubuntu
CMD [ "sh", "-c", "echo $HOME" ]
```

以下のコマンドを実行してください。

```sh
docker build -t cmd6 -f Dockerfile.cmd6 .
docker run cmd6
```

```sh
# SIGTERM not received with shell form
docker run nginx:1.21
```

以下のショートカットを実行してください。

```sh
# Ctrl + c
```

以下のコマンドを実行してください。

````sh
docker build - t nginx: cmd-shellform - f Dockerfile.cmd-nginx .
docker run - -name cnt-nginx-shellform nginx: cmd-shellform
# Ctrl + c, not working!!
```

```sh:another terminal
docker stop cnt-nginx-shellform

```dockerfile:Dockerfile.cmd7
FROM ubuntu
CMD ["tail", "-f", "/dev/null"]
```

以下のコマンドを実行してください。

```sh
docker build -t cmd7 -f Dockerfile.cmd7 .
docker run cmd7
```

```dockerfile:Dockerfile.cmd8
FROM ubuntu
CMD tail -f /dev/null
```

以下のコマンドを実行してください。

```sh
docker build -t cmd8 -f Dockerfile.cmd8 .
docker run cmd8
```

```dockerfile:Dockerfile.cmd9
FROM ubuntu
CMD ["echo", "abc"]
CMD ["echo", "def"]
```

以下のコマンドを実行してください。

```sh
docker build -t cmd9 -f Dockerfile.cmd9 .
docker run cmd9
```

````
